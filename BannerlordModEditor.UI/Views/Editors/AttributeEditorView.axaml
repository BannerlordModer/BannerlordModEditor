<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BannerlordModEditor.UI.ViewModels.Editors"
             x:Class="BannerlordModEditor.UI.Views.Editors.AttributeEditorView"
             x:DataType="vm:AttributeEditorViewModel">

  <Grid RowDefinitions="Auto,*">
    <!-- å·¥å…·æ  -->
    <Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,0,1" Padding="16,12">
      <Grid ColumnDefinitions="Auto,Auto,Auto,*,Auto">
        <Button Grid.Column="0" Content="ðŸ“ åŠ è½½æ–‡ä»¶" Command="{Binding LoadFileCommand}" Margin="0,0,8,0" Classes="accent" />
        <Button Grid.Column="1" Content="ðŸ’¾ ä¿å­˜æ–‡ä»¶" Command="{Binding SaveFileCommand}" Margin="0,0,8,0" Classes="accent" />
        <Button Grid.Column="2" Content="âž• æ·»åŠ å±žæ€§" Command="{Binding AddAttributeCommand}" Margin="0,0,16,0" Classes="accent" />
        
        <!-- æ–‡ä»¶ä¿¡æ¯ -->
        <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
          <TextBlock Text="ðŸ“„ å½“å‰æ–‡ä»¶: " Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
          <TextBlock Text="{Binding FilePath}" FontWeight="Medium" />
          <TextBlock Text=" (æœªä¿å­˜)" IsVisible="{Binding HasUnsavedChanges}" 
                     Foreground="{DynamicResource SystemAccentColor}" FontWeight="Bold" Margin="8,0,0,0" />
        </StackPanel>
        
        <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <Border Grid.Column="4" Background="{DynamicResource SystemControlSuccessBackgroundBrush}" CornerRadius="12" Padding="8,4"
                IsVisible="{Binding !HasUnsavedChanges}">
          <TextBlock Text="âœ… å·²ä¿å­˜" FontSize="12" Foreground="{DynamicResource SystemControlSuccessForegroundBrush}" FontWeight="Bold" />
        </Border>
        <Border Grid.Column="4" Background="{DynamicResource SystemControlWarningBackgroundBrush}" CornerRadius="12" Padding="8,4"
                IsVisible="{Binding HasUnsavedChanges}">
          <TextBlock Text="âš ï¸ æœªä¿å­˜" FontSize="12" Foreground="{DynamicResource SystemControlWarningForegroundBrush}" FontWeight="Bold" />
        </Border>
      </Grid>
    </Border>

    <!-- å±žæ€§åˆ—è¡¨ -->
    <ScrollViewer Grid.Row="1" Margin="10">
      <ItemsControl ItemsSource="{Binding Attributes}">
        <ItemsControl.ItemTemplate>
          <DataTemplate x:DataType="vm:AttributeDataViewModel">
            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="5" 
                    Margin="0,5" Padding="10" Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
              <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="120,*,Auto">
                
                <!-- ID -->
                <TextBlock Grid.Row="0" Grid.Column="0" Text="ID:" VerticalAlignment="Center" />
                <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Id}" Margin="5,0" />
                
                <!-- Name -->
                <TextBlock Grid.Row="1" Grid.Column="0" Text="åç§°:" VerticalAlignment="Center" />
                <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Name}" Margin="5,0" />
                
                <!-- Source -->
                <TextBlock Grid.Row="2" Grid.Column="0" Text="æ¥æº:" VerticalAlignment="Center" />
                <ComboBox Grid.Row="2" Grid.Column="1" 
                          ItemsSource="{Binding SourceOptions}"
                          SelectedItem="{Binding Source}" 
                          Margin="5,0" />
                
                <!-- Documentation -->
                <TextBlock Grid.Row="3" Grid.Column="0" Text="æ–‡æ¡£:" VerticalAlignment="Top" />
                <TextBox Grid.Row="3" Grid.Column="1" 
                         Text="{Binding Documentation}" 
                         AcceptsReturn="True" TextWrapping="Wrap" 
                         MinHeight="60" Margin="5,0" />
                
                <!-- åˆ é™¤æŒ‰é’® -->
                <Button Grid.Row="0" Grid.Column="2" Grid.RowSpan="4"
                        Content="åˆ é™¤" 
                        Command="{Binding $parent[ItemsControl].((vm:AttributeEditorViewModel)DataContext).RemoveAttributeCommand}"
                        CommandParameter="{Binding}"
                        Classes="danger"
                        VerticalAlignment="Center" />
                
                <!-- éªŒè¯æŒ‡ç¤ºå™¨ -->
                <Border Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3"
                        Background="{DynamicResource SystemControlErrorBackgroundBrush}" CornerRadius="3" Padding="5" Margin="0,5,0,0"
                        IsVisible="{Binding !IsValid}">
                  <TextBlock Text="é”™è¯¯: IDå’Œåç§°ä¸èƒ½ä¸ºç©º" Foreground="{DynamicResource SystemControlErrorForegroundBrush}" FontWeight="Bold" />
                </Border>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>
  </Grid>
</UserControl> 