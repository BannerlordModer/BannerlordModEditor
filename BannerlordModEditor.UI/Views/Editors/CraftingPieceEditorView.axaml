<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:BannerlordModEditor.UI.ViewModels.Editors"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:DataType="vm:CraftingPieceEditorViewModel"
             x:Class="BannerlordModEditor.UI.Views.Editors.CraftingPieceEditorView">

  <UserControl.Styles>
    <Style Selector="Button.crafting-piece">
      <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseLowBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundBaseLowBrush}"/>
    </Style>
    <Style Selector="Button.crafting-piece.invalid">
      <Setter Property="Background" Value="{DynamicResource SystemControlErrorBackgroundBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource SystemControlErrorTextForegroundBrush}"/>
    </Style>
  </UserControl.Styles>

  <Grid RowDefinitions="Auto,*" Margin="16">
    <!-- å·¥å…·æ  -->
    <Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto,Auto" Margin="0,0,0,16">
      <TextBlock Grid.Column="0" Text="åˆ¶ä½œéƒ¨ä»¶ç¼–è¾‘å™¨" FontWeight="Bold" FontSize="18" VerticalAlignment="Center"/>
      
      <Button Grid.Column="1" Command="{Binding LoadFileCommand}" Margin="4" Classes="accent">
        <StackPanel Orientation="Horizontal">
          <TextBlock Text="ðŸ“‚" FontSize="14" Margin="0,0,4,0"/>
          <TextBlock Text="åŠ è½½æ–‡ä»¶"/>
        </StackPanel>
      </Button>
      
      <Button Grid.Column="2" Command="{Binding SaveFileCommand}" 
              IsEnabled="{Binding HasUnsavedChanges}" Margin="4" Classes="accent">
        <StackPanel Orientation="Horizontal">
          <TextBlock Text="ðŸ’¾" FontSize="14" Margin="0,0,4,0"/>
          <TextBlock Text="ä¿å­˜"/>
        </StackPanel>
      </Button>
      
      <Button Grid.Column="3" Command="{Binding AddCraftingPieceCommand}" Margin="4" Classes="accent">
        <StackPanel Orientation="Horizontal">
          <TextBlock Text="âž•" FontSize="14" Margin="0,0,4,0"/>
          <TextBlock Text="æ·»åŠ éƒ¨ä»¶"/>
        </StackPanel>
      </Button>
    </Grid>

    <!-- çŠ¶æ€æ  -->
    <TextBlock Grid.Row="0" Text="{Binding FilePath}" 
               HorizontalAlignment="Left" 
               VerticalAlignment="Bottom"
               FontSize="12" 
               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" 
               Margin="0,24,0,8"/>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <Grid Grid.Row="1" ColumnDefinitions="300,4,*">
      
      <!-- å·¦ä¾§åˆ—è¡¨ -->
      <Border Grid.Column="0" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="8">
        <Grid RowDefinitions="Auto,*,Auto">
          <TextBlock Grid.Row="0" Text="åˆ¶ä½œéƒ¨ä»¶åˆ—è¡¨" FontWeight="SemiBold" Margin="12,12,12,8"/>
          
          <ScrollViewer Grid.Row="1">
            <ItemsControl ItemsSource="{Binding CraftingPieces}" Margin="8">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="vm:CraftingPieceDataViewModel">
                  <Button Classes="crafting-piece"
                          Classes.invalid="{Binding !IsValid}"
                          BorderThickness="1" 
                          CornerRadius="4" 
                          Margin="0,0,0,4" 
                          Padding="8"
                          Command="{Binding $parent[UserControl].((vm:CraftingPieceEditorViewModel)DataContext).SelectCraftingPieceCommand}" 
                          CommandParameter="{Binding}"
                          HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Left">
                    <StackPanel>
                      <TextBlock Text="{Binding Name}" FontWeight="Medium" FontSize="13"/>
                      <TextBlock Text="{Binding Id}" FontSize="11" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="0,2,0,0"/>
                      <TextBlock Text="{Binding CraftingPieceType}" FontSize="10" Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}"/>
                    </StackPanel>
                  </Button>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
          
          <TextBlock Grid.Row="2" Text="{Binding CraftingPieces.Count, StringFormat='å…± \{0\} ä¸ªéƒ¨ä»¶'}" 
                     FontSize="11" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="12,8,12,12"/>
        </Grid>
      </Border>

      <!-- åˆ†éš”æ¡ -->
      <GridSplitter Grid.Column="1" Background="{DynamicResource SystemControlForegroundBaseLowBrush}" ResizeDirection="Columns"/>

      <!-- å³ä¾§è¯¦ç»†ç¼–è¾‘åŒºåŸŸ -->
      <ScrollViewer Grid.Column="2" Margin="16,0,0,0">
        <Grid>
          <StackPanel IsVisible="{Binding SelectedCraftingPiece, Converter={x:Static ObjectConverters.IsNotNull}}">
            
            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,0,16">
              <StackPanel>
                <TextBlock Text="åŸºæœ¬ä¿¡æ¯" FontWeight="Bold" FontSize="16" Margin="0,0,0,12"/>
                
                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="120,*,Auto" RowSpacing="8">
                  
                  <!-- ID -->
                  <TextBlock Grid.Row="0" Grid.Column="0" Text="ID:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedCraftingPiece.Id}" />
                  
                  <!-- åç§° -->
                  <TextBlock Grid.Row="1" Grid.Column="0" Text="åç§°:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedCraftingPiece.Name}" />
                  
                  <!-- ç±»åž‹ -->
                  <TextBlock Grid.Row="2" Grid.Column="0" Text="éƒ¨ä»¶ç±»åž‹:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <ComboBox Grid.Row="2" Grid.Column="1" SelectedItem="{Binding SelectedCraftingPiece.CraftingPieceType}">
                    <ComboBoxItem>blade</ComboBoxItem>
                    <ComboBoxItem>guard</ComboBoxItem>
                    <ComboBoxItem>handle</ComboBoxItem>
                    <ComboBoxItem>pommel</ComboBoxItem>
                    <ComboBoxItem>bow_arm</ComboBoxItem>
                    <ComboBoxItem>bow_string</ComboBoxItem>
                    <ComboBoxItem>arrow_head</ComboBoxItem>
                    <ComboBoxItem>arrow_shaft</ComboBoxItem>
                  </ComboBox>
                  
                  <!-- ç­‰çº§ -->
                  <TextBlock Grid.Row="3" Grid.Column="0" Text="éƒ¨ä»¶ç­‰çº§:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding SelectedCraftingPiece.PieceTier}" />
                  
                  <!-- æ–‡åŒ– -->
                  <TextBlock Grid.Row="4" Grid.Column="0" Text="æ–‡åŒ–:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding SelectedCraftingPiece.Culture}" />
                  
                  <!-- ç¼©æ”¾å› å­ -->
                  <TextBlock Grid.Row="5" Grid.Column="0" Text="ç¼©æ”¾å› å­:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding SelectedCraftingPiece.ScaleFactor}" />
                  
                  <!-- ç½‘æ ¼ -->
                  <TextBlock Grid.Row="6" Grid.Column="0" Text="ç½‘æ ¼:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="6" Grid.Column="1" Text="{Binding SelectedCraftingPiece.Mesh}" />
                  
                  <!-- ç‰©ç†æè´¨ -->
                  <TextBlock Grid.Row="7" Grid.Column="0" Text="ç‰©ç†æè´¨:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="7" Grid.Column="1" Text="{Binding SelectedCraftingPiece.PhysicsMaterial}" />
                  
                  <!-- æ˜¯å¦éšè— -->
                  <TextBlock Grid.Row="8" Grid.Column="0" Text="æ˜¯å¦éšè—:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <ComboBox Grid.Row="8" Grid.Column="1" SelectedItem="{Binding SelectedCraftingPiece.IsHidden}">
                    <ComboBoxItem>true</ComboBoxItem>
                    <ComboBoxItem>false</ComboBoxItem>
                    <ComboBoxItem></ComboBoxItem>
                  </ComboBox>
                  
                  <!-- åˆ é™¤æŒ‰é’® -->
                  <Button Grid.Row="0" Grid.Column="2" Grid.RowSpan="9" 
                          Command="{Binding RemoveCraftingPieceCommand}" 
                          CommandParameter="{Binding SelectedCraftingPiece}"
                          Classes="danger"
                          VerticalAlignment="Top"
                          Margin="8,0,0,0">
                    <StackPanel Orientation="Horizontal">
                      <TextBlock Text="ðŸ—‘ï¸" FontSize="12" Margin="0,0,4,0"/>
                      <TextBlock Text="åˆ é™¤"/>
                    </StackPanel>
                  </Button>
                </Grid>
              </StackPanel>
            </Border>
            
            <!-- æ­¦å™¨æ•°æ® -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,0,16">
              <StackPanel>
                <TextBlock Text="æ­¦å™¨æ•°æ®" FontWeight="Bold" FontSize="16" Margin="0,0,0,12"/>
                
                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="120,120,120,*" RowSpacing="8" ColumnSpacing="8">
                  <!-- ä¼¤å®³ç±»åž‹ -->
                  <TextBlock Grid.Row="0" Grid.Column="0" Text="åˆºå‡»ä¼¤å®³:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedCraftingPiece.ThrustDamage}" />
                  <TextBlock Grid.Row="0" Grid.Column="2" Text="æŒ¥ç ä¼¤å®³:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="0" Grid.Column="3" Text="{Binding SelectedCraftingPiece.SwingDamage}" />
                  
                  <!-- é€Ÿåº¦ -->
                  <TextBlock Grid.Row="1" Grid.Column="0" Text="åˆºå‡»é€Ÿåº¦:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedCraftingPiece.ThrustSpeed}" />
                  <TextBlock Grid.Row="1" Grid.Column="2" Text="æŒ¥ç é€Ÿåº¦:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding SelectedCraftingPiece.SwingSpeed}" />
                  
                  <!-- å…¶ä»–å±žæ€§ -->
                  <TextBlock Grid.Row="2" Grid.Column="0" Text="æ­¦å™¨é•¿åº¦:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SelectedCraftingPiece.WeaponLength}" />
                  <TextBlock Grid.Row="2" Grid.Column="2" Text="é‡é‡:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="2" Grid.Column="3" Text="{Binding SelectedCraftingPiece.Weight}" />
                  
                  <TextBlock Grid.Row="3" Grid.Column="0" Text="ç²¾åº¦:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding SelectedCraftingPiece.Accuracy}" />
                  <TextBlock Grid.Row="3" Grid.Column="2" Text="æ­¦å™¨å¹³è¡¡:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="3" Grid.Column="3" Text="{Binding SelectedCraftingPiece.WeaponBalance}" />
                  
                  <TextBlock Grid.Row="4" Grid.Column="0" Text="ç”Ÿå‘½å€¼:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding SelectedCraftingPiece.HitPoints}" />
                  <TextBlock Grid.Row="4" Grid.Column="2" Text="æ“æŽ§æ€§:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="4" Grid.Column="3" Text="{Binding SelectedCraftingPiece.Handling}" />
                  
                  <TextBlock Grid.Row="5" Grid.Column="0" Text="æŠ¤ç”²ç­‰çº§:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding SelectedCraftingPiece.ArmorRating}" />
                  <TextBlock Grid.Row="5" Grid.Column="2" Text="å¼¹è¯é™åˆ¶:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="5" Grid.Column="3" Text="{Binding SelectedCraftingPiece.AmmoLimit}" />
                </Grid>
              </StackPanel>
            </Border>
            
            <!-- ææ–™å’Œä¿®é¥°ç¬¦ä¿¡æ¯ -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,0,16">
              <StackPanel>
                <TextBlock Text="é™„åŠ ä¿¡æ¯" FontWeight="Bold" FontSize="16" Margin="0,0,0,12"/>
                
                <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="120,*" RowSpacing="8">
                  <TextBlock Grid.Row="0" Grid.Column="0" Text="ææ–™æ•°é‡:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SelectedCraftingPiece.Materials.Count, StringFormat='\{0\} ä¸ªææ–™'}" />
                  
                  <TextBlock Grid.Row="1" Grid.Column="0" Text="ä¿®é¥°ç¬¦æ•°é‡:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SelectedCraftingPiece.Modifiers.Count, StringFormat='\{0\} ä¸ªä¿®é¥°ç¬¦'}" />
                  
                  <TextBlock Grid.Row="2" Grid.Column="0" Text="æ ‡å¿—æ•°é‡:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SelectedCraftingPiece.Flags.Count, StringFormat='\{0\} ä¸ªæ ‡å¿—'}" />
                  
                  <TextBlock Grid.Row="3" Grid.Column="0" Text="éœ€æ±‚æ•°é‡:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SelectedCraftingPiece.Requirements.Count, StringFormat='\{0\} ä¸ªéœ€æ±‚'}" />
                </Grid>
                
                <TextBlock Text="æ³¨æ„ï¼šæ­¤ç‰ˆæœ¬ä¸ºç®€åŒ–ç¼–è¾‘å™¨ï¼Œè¯¦ç»†çš„ææ–™ã€ä¿®é¥°ç¬¦ã€æ ‡å¿—å’Œéœ€æ±‚ç¼–è¾‘åŠŸèƒ½å°†åœ¨åŽç»­ç‰ˆæœ¬ä¸­æ·»åŠ ã€‚" 
                           FontSize="12" 
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" 
                           FontStyle="Italic"
                           Margin="0,12,0,0"/>
              </StackPanel>
            </Border>
            
          </StackPanel>
          
          <!-- æœªé€‰æ‹©æç¤º -->
          <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" 
                     IsVisible="{Binding SelectedCraftingPiece, Converter={x:Static ObjectConverters.IsNull}}">
            <TextBlock Text="ðŸ”§" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,16"/>
            <TextBlock Text="é€‰æ‹©å·¦ä¾§çš„åˆ¶ä½œéƒ¨ä»¶è¿›è¡Œç¼–è¾‘" 
                      FontSize="18" 
                      HorizontalAlignment="Center"
                      Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
          </StackPanel>
        </Grid>
      </ScrollViewer>
      
    </Grid>
  </Grid>
</UserControl> 