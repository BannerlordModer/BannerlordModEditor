<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BannerlordModEditor.UI.ViewModels.Editors"
             x:Class="BannerlordModEditor.UI.Views.Editors.DataGridEditorView"
             x:DataType="vm:DataGridEditorViewModel`2">
             
  <Grid RowDefinitions="Auto,*,Auto">
    <!-- å·¥å…·æ  -->
    <Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,0,1" Padding="16,12">
      <Grid ColumnDefinitions="Auto,Auto,Auto,*,Auto,Auto,Auto">
        <Button Grid.Column="0" Content="ðŸ“ åŠ è½½æ–‡ä»¶" Command="{Binding LoadXmlFileCommand}" Margin="0,0,8,0" Classes="accent" />
        <Button Grid.Column="1" Content="ðŸ’¾ ä¿å­˜æ–‡ä»¶" Command="{Binding SaveXmlFileCommand}" Margin="0,0,8,0" Classes="accent" />
        <Button Grid.Column="2" Content="âž• æ·»åŠ é¡¹" Command="{Binding AddItemCommand}" Margin="0,0,16,0" Classes="accent" />
        
        <!-- æ–‡ä»¶ä¿¡æ¯ -->
        <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
          <TextBlock Text="ðŸ“„ å½“å‰æ–‡ä»¶: " Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
          <TextBlock Text="{Binding FilePath}" FontWeight="Medium" />
          <TextBlock Text=" (æœªä¿å­˜)" IsVisible="{Binding HasUnsavedChanges}" 
                     Foreground="{DynamicResource SystemAccentColor}" FontWeight="Bold" Margin="8,0,0,0" />
        </StackPanel>
        
        <!-- æœç´¢æ¡† -->
        <TextBox Grid.Column="4" Text="{Binding SearchFilter}" 
                 Watermark="æœç´¢..." 
                 Margin="8,0"
                 Width="200"
                 VerticalAlignment="Center" />
        
        <!-- è®¡æ•°ä¿¡æ¯ -->
        <StackPanel Grid.Column="5" Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0">
          <TextBlock Text="æ€»è®¡: " Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
          <TextBlock Text="{Binding TotalCount}" FontWeight="Medium" />
          <TextBlock Text=" | è¿‡æ»¤: " Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="8,0,0,0" />
          <TextBlock Text="{Binding FilteredCount}" FontWeight="Medium" />
        </StackPanel>
        
        <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <Border Grid.Column="6" Background="{DynamicResource SystemControlSuccessBackgroundBrush}" CornerRadius="12" Padding="8,4"
                IsVisible="{Binding !HasUnsavedChanges}">
          <TextBlock Text="âœ… å·²ä¿å­˜" FontSize="12" Foreground="{DynamicResource SystemControlSuccessForegroundBrush}" FontWeight="Bold" />
        </Border>
        <Border Grid.Column="6" Background="{DynamicResource SystemControlWarningBackgroundBrush}" CornerRadius="12" Padding="8,4"
                IsVisible="{Binding HasUnsavedChanges}">
          <TextBlock Text="âš ï¸ æœªä¿å­˜" FontSize="12" Foreground="{DynamicResource SystemControlWarningForegroundBrush}" FontWeight="Bold" />
        </Border>
      </Grid>
    </Border>

    <!-- æ•°æ®ç½‘æ ¼ -->
    <Grid Grid.Row="1">
      <Grid.RowDefinitions>
        <RowDefinition Height="*" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>
      
      <!-- ä¸»è¦æ•°æ®ç½‘æ ¼ -->
      <DataGrid Grid.Row="0"
                ItemsSource="{Binding FilteredItems}"
                SelectedItem="{Binding SelectedItem}"
                AutoGenerateColumns="True"
                CanUserResizeColumns="True"
                CanUserReorderColumns="True"
                CanUserSortColumns="True"
                GridLinesVisibility="Horizontal"
                HeadersVisibility="Column"
                Margin="8">
        
        <DataGrid.Styles>
          <Style Selector="DataGridCell">
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="VerticalAlignment" Value="Center" />
          </Style>
          <Style Selector="DataGridColumnHeader">
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltHighBrush}" />
            <Setter Property="FontWeight" Value="Bold" />
          </Style>
        </DataGrid.Styles>
      </DataGrid>
      
      <!-- çŠ¶æ€ä¿¡æ¯ -->
      <Border Grid.Row="1" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              Padding="8" Margin="0,4,0,0">
        <TextBlock Text="{Binding StatusMessage}" 
                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                   FontSize="12" />
      </Border>
    </Grid>

    <!-- åº•éƒ¨å·¥å…·æ  -->
    <Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
            BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,1,0,0" 
            Padding="16,8">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <!-- å¿«é€Ÿæ“ä½œæŒ‰é’® -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
          <Button Content="ðŸ”„ åˆ·æ–°" Command="{Binding RefreshCommandCommand}" Classes="accent" />
          <Button Content="ðŸ—‘ï¸ æ¸…ç©º" Command="{Binding ClearCommand}" Classes="danger" />
        </StackPanel>
        
        <!-- å¸®åŠ©ä¿¡æ¯ -->
        <TextBlock Grid.Column="2" 
                   Text="æç¤º: åŒå‡»è¡Œå¯ç¼–è¾‘ï¼Œä½¿ç”¨æœç´¢æ¡†å¯å¿«é€Ÿè¿‡æ»¤æ•°æ®"
                   Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}"
                   FontSize="11"
                   VerticalAlignment="Center" />
      </Grid>
    </Border>
  </Grid>
</UserControl>