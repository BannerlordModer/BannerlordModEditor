<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:BannerlordModEditor.UI.ViewModels.Editors"
             x:Class="BannerlordModEditor.UI.Views.Editors.DataGridEditorView"
             x:DataType="vm:DataGridEditorViewModel`2">
             
  <Grid RowDefinitions="Auto,*,Auto">
    <!-- 工具栏 -->
    <Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,0,0,1" Padding="16,12">
      <Grid ColumnDefinitions="Auto,Auto,Auto,*,Auto,Auto,Auto">
        <Button Grid.Column="0" Content="📁 加载文件" Command="{Binding LoadXmlFileCommand}" Margin="0,0,8,0" Classes="accent" />
        <Button Grid.Column="1" Content="💾 保存文件" Command="{Binding SaveXmlFileCommand}" Margin="0,0,8,0" Classes="accent" />
        <Button Grid.Column="2" Content="➕ 添加项" Command="{Binding AddItemCommand}" Margin="0,0,16,0" Classes="accent" />
        
        <!-- 文件信息 -->
        <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center">
          <TextBlock Text="📄 当前文件: " Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
          <TextBlock Text="{Binding FilePath}" FontWeight="Medium" />
          <TextBlock Text=" (未保存)" IsVisible="{Binding HasUnsavedChanges}" 
                     Foreground="{DynamicResource SystemAccentColor}" FontWeight="Bold" Margin="8,0,0,0" />
        </StackPanel>
        
        <!-- 搜索框 -->
        <TextBox Grid.Column="4" Text="{Binding SearchFilter}" 
                 Watermark="搜索..." 
                 Margin="8,0"
                 Width="200"
                 VerticalAlignment="Center" />
        
        <!-- 计数信息 -->
        <StackPanel Grid.Column="5" Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0">
          <TextBlock Text="总计: " Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
          <TextBlock Text="{Binding TotalCount}" FontWeight="Medium" />
          <TextBlock Text=" | 过滤: " Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="8,0,0,0" />
          <TextBlock Text="{Binding FilteredCount}" FontWeight="Medium" />
        </StackPanel>
        
        <!-- 状态指示器 -->
        <Border Grid.Column="6" Background="{DynamicResource SystemControlSuccessBackgroundBrush}" CornerRadius="12" Padding="8,4"
                IsVisible="{Binding !HasUnsavedChanges}">
          <TextBlock Text="✅ 已保存" FontSize="12" Foreground="{DynamicResource SystemControlSuccessForegroundBrush}" FontWeight="Bold" />
        </Border>
        <Border Grid.Column="6" Background="{DynamicResource SystemControlWarningBackgroundBrush}" CornerRadius="12" Padding="8,4"
                IsVisible="{Binding HasUnsavedChanges}">
          <TextBlock Text="⚠️ 未保存" FontSize="12" Foreground="{DynamicResource SystemControlWarningForegroundBrush}" FontWeight="Bold" />
        </Border>
      </Grid>
    </Border>

    <!-- 数据网格 -->
    <Grid Grid.Row="1">
      <Grid.RowDefinitions>
        <RowDefinition Height="*" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>
      
      <!-- 主要数据网格 -->
      <DataGrid Grid.Row="0"
                ItemsSource="{Binding FilteredItems}"
                SelectedItem="{Binding SelectedItem}"
                AutoGenerateColumns="True"
                CanUserResizeColumns="True"
                CanUserReorderColumns="True"
                CanUserSortColumns="True"
                GridLinesVisibility="Horizontal"
                HeadersVisibility="Column"
                Margin="8">
        
        <DataGrid.Styles>
          <Style Selector="DataGridCell">
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="VerticalAlignment" Value="Center" />
          </Style>
          <Style Selector="DataGridColumnHeader">
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltHighBrush}" />
            <Setter Property="FontWeight" Value="Bold" />
          </Style>
        </DataGrid.Styles>
      </DataGrid>
      
      <!-- 状态信息 -->
      <Border Grid.Row="1" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
              Padding="8" Margin="0,4,0,0">
        <TextBlock Text="{Binding StatusMessage}" 
                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                   FontSize="12" />
      </Border>
    </Grid>

    <!-- 底部工具栏 -->
    <Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
            BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="0,1,0,0" 
            Padding="16,8">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <!-- 快速操作按钮 -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
          <Button Content="🔄 刷新" Command="{Binding RefreshCommandCommand}" Classes="accent" />
          <Button Content="🗑️ 清空" Command="{Binding ClearCommand}" Classes="danger" />
        </StackPanel>
        
        <!-- 帮助信息 -->
        <TextBlock Grid.Column="2" 
                   Text="提示: 双击行可编辑，使用搜索框可快速过滤数据"
                   Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}"
                   FontSize="11"
                   VerticalAlignment="Center" />
      </Grid>
    </Border>
  </Grid>
</UserControl>