<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:BannerlordModEditor.UI.ViewModels.Editors"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:DataType="vm:ItemModifierEditorViewModel"
             x:Class="BannerlordModEditor.UI.Views.Editors.ItemModifierEditorView">
  <UserControl.Styles>
    <Style Selector="Button.item-modifier">
      <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseLowBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundBaseLowBrush}"/>
    </Style>
    <Style Selector="Button.item-modifier.invalid">
      <Setter Property="Background" Value="{DynamicResource SystemControlErrorBackgroundBrush}"/>
      <Setter Property="BorderBrush" Value="{DynamicResource SystemControlErrorTextForegroundBrush}"/>
    </Style>
  </UserControl.Styles>
  <Grid RowDefinitions="Auto,*" Margin="16">
    <!-- å·¥å…·æ  -->
    <Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto,Auto" Margin="0,0,0,16">
      <TextBlock Grid.Column="0" Text="ç‰©å“ä¿®é¥°ç¬¦ç¼–è¾‘å™¨" FontWeight="Bold" FontSize="18" VerticalAlignment="Center"/>
      
      <Button Grid.Column="1" Command="{Binding LoadFileCommand}" Margin="4" Classes="accent">
        <StackPanel Orientation="Horizontal">
          <TextBlock Text="ðŸ“‚" FontSize="14" Margin="0,0,4,0"/>
          <TextBlock Text="åŠ è½½æ–‡ä»¶"/>
        </StackPanel>
      </Button>
      
      <Button Grid.Column="2" Command="{Binding SaveFileCommand}" 
              IsEnabled="{Binding HasUnsavedChanges}" Margin="4" Classes="accent">
        <StackPanel Orientation="Horizontal">
          <TextBlock Text="ðŸ’¾" FontSize="14" Margin="0,0,4,0"/>
          <TextBlock Text="ä¿å­˜"/>
        </StackPanel>
      </Button>
      
      <Button Grid.Column="3" Command="{Binding AddItemModifierCommand}" Margin="4" Classes="accent">
        <StackPanel Orientation="Horizontal">
          <TextBlock Text="âž•" FontSize="14" Margin="0,0,4,0"/>
          <TextBlock Text="æ·»åŠ ä¿®é¥°ç¬¦"/>
        </StackPanel>
      </Button>
    </Grid>

    <!-- çŠ¶æ€æ  -->
    <TextBlock Grid.Row="0" Text="{Binding FilePath}" 
               HorizontalAlignment="Left" 
               VerticalAlignment="Bottom"
               FontSize="12" 
               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" 
               Margin="0,24,0,8"/>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <Grid Grid.Row="1" ColumnDefinitions="300,4,*">
      
      <!-- å·¦ä¾§åˆ—è¡¨ -->
      <Border Grid.Column="0" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="8">
        <Grid RowDefinitions="Auto,*,Auto">
          <TextBlock Grid.Row="0" Text="ä¿®é¥°ç¬¦åˆ—è¡¨" FontWeight="SemiBold" Margin="12,12,12,8"/>
          
          <ScrollViewer Grid.Row="1">
            <ItemsControl ItemsSource="{Binding ItemModifiers}" Margin="8">
              <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="vm:ItemModifierDataViewModel">
                  <Button Classes="item-modifier"
                          Classes.invalid="{Binding !IsValid}"
                          BorderThickness="1" 
                          CornerRadius="4" 
                          Margin="0,0,0,4" 
                          Padding="8"
                          Command="{Binding $parent[UserControl].((vm:ItemModifierEditorViewModel)DataContext).SelectItemModifierCommand}" 
                          CommandParameter="{Binding}"
                          HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Left">
                    <StackPanel>
                      <TextBlock Text="{Binding Name}" FontWeight="Medium" FontSize="13"/>
                      <TextBlock Text="{Binding Id}" FontSize="11" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="0,2,0,0"/>
                      <TextBlock Text="{Binding Quality}" FontSize="10" Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}"/>
                    </StackPanel>
                  </Button>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
          
          <TextBlock Grid.Row="2" Text="{Binding ItemModifiers.Count, StringFormat='å…± {0} ä¸ªä¿®é¥°ç¬¦'}" 
                     FontSize="11" Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" Margin="12,8,12,12"/>
        </Grid>
      </Border>

      <!-- åˆ†éš”æ¡ -->
      <GridSplitter Grid.Column="1" Background="{DynamicResource SystemControlForegroundBaseLowBrush}" ResizeDirection="Columns"/>

      <!-- å³ä¾§è¯¦ç»†ç¼–è¾‘åŒºåŸŸ -->
      <ScrollViewer Grid.Column="2" Margin="16,0,0,0">
        <Grid>
          <StackPanel IsVisible="{Binding SelectedItemModifier, Converter={x:Static ObjectConverters.IsNotNull}}">
            
            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,0,16">
              <StackPanel>
                <TextBlock Text="åŸºæœ¬ä¿¡æ¯" FontWeight="Bold" FontSize="16" Margin="0,0,0,12"/>
                
                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="120,*,Auto" RowSpacing="8">
                  
                  <!-- ID -->
                  <TextBlock Grid.Row="0" Grid.Column="0" Text="ID:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedItemModifier.Id}" />
                  
                  <!-- åç§° -->
                  <TextBlock Grid.Row="1" Grid.Column="0" Text="åç§°:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedItemModifier.Name}" />
                  
                  <!-- ä¿®é¥°ç¬¦ç»„ -->
                  <TextBlock Grid.Row="2" Grid.Column="0" Text="ä¿®é¥°ç¬¦ç»„:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SelectedItemModifier.ModifierGroup}" />
                  
                  <!-- å“è´¨ -->
                  <TextBlock Grid.Row="3" Grid.Column="0" Text="å“è´¨:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <ComboBox Grid.Row="3" Grid.Column="1" SelectedItem="{Binding SelectedItemModifier.Quality}">
                    <ComboBoxItem>poor</ComboBoxItem>
                    <ComboBoxItem>inferior</ComboBoxItem>
                    <ComboBoxItem>normal</ComboBoxItem>
                    <ComboBoxItem>fine</ComboBoxItem>
                    <ComboBoxItem>masterwork</ComboBoxItem>
                    <ComboBoxItem>legendary</ComboBoxItem>
                  </ComboBox>
                  
                  <!-- ä»·æ ¼å› å­ -->
                  <TextBlock Grid.Row="4" Grid.Column="0" Text="ä»·æ ¼å› å­:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding SelectedItemModifier.PriceFactor}" />
                  
                  <!-- æˆ˜åˆ©å“æŽ‰è½åˆ†æ•° -->
                  <TextBlock Grid.Row="5" Grid.Column="0" Text="æˆ˜åˆ©å“åˆ†æ•°:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding SelectedItemModifier.LootDropScore}" />
                  
                  <!-- ç”Ÿäº§æŽ‰è½åˆ†æ•° -->
                  <TextBlock Grid.Row="6" Grid.Column="0" Text="ç”Ÿäº§åˆ†æ•°:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="6" Grid.Column="1" Text="{Binding SelectedItemModifier.ProductionDropScore}" />
                  
                  <!-- åˆ é™¤æŒ‰é’® -->
                  <Button Grid.Row="0" Grid.Column="2" Grid.RowSpan="7" 
                          Command="{Binding RemoveItemModifierCommand}" 
                          CommandParameter="{Binding SelectedItemModifier}"
                          Classes="danger"
                          VerticalAlignment="Top"
                          Margin="8,0,0,0">
                    <StackPanel Orientation="Horizontal">
                      <TextBlock Text="ðŸ—‘ï¸" FontSize="12" Margin="0,0,4,0"/>
                      <TextBlock Text="åˆ é™¤"/>
                    </StackPanel>
                  </Button>
                </Grid>
              </StackPanel>
            </Border>
            
            <!-- æ­¦å™¨å±žæ€§ -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,0,16">
              <StackPanel>
                <TextBlock Text="æ­¦å™¨å±žæ€§" FontWeight="Bold" FontSize="16" Margin="0,0,0,12"/>
                
                <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="120,*" RowSpacing="8">
                  <TextBlock Grid.Row="0" Grid.Column="0" Text="ä¼¤å®³:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedItemModifier.Damage}" />
                  
                  <TextBlock Grid.Row="1" Grid.Column="0" Text="é€Ÿåº¦:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedItemModifier.Speed}" />
                  
                  <TextBlock Grid.Row="2" Grid.Column="0" Text="æŠ•å°„é€Ÿåº¦:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SelectedItemModifier.MissileSpeed}" />
                  
                  <TextBlock Grid.Row="3" Grid.Column="0" Text="å †å æ•°é‡:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding SelectedItemModifier.StackCount}" />
                </Grid>
              </StackPanel>
            </Border>
            
            <!-- æŠ¤ç”²å±žæ€§ -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,0,16">
              <StackPanel>
                <TextBlock Text="æŠ¤ç”²å±žæ€§" FontWeight="Bold" FontSize="16" Margin="0,0,0,12"/>
                
                <Grid RowDefinitions="Auto" ColumnDefinitions="120,*" RowSpacing="8">
                  <TextBlock Grid.Row="0" Grid.Column="0" Text="æŠ¤ç”²å€¼:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedItemModifier.Armor}" />
                </Grid>
              </StackPanel>
            </Border>
            
            <!-- é©¬åŒ¹å±žæ€§ -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}" BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,0,16">
              <StackPanel>
                <TextBlock Text="é©¬åŒ¹å±žæ€§" FontWeight="Bold" FontSize="16" Margin="0,0,0,12"/>
                
                <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="120,*" RowSpacing="8">
                  <TextBlock Grid.Row="0" Grid.Column="0" Text="é©¬åŒ¹é€Ÿåº¦:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SelectedItemModifier.HorseSpeed}" />
                  
                  <TextBlock Grid.Row="1" Grid.Column="0" Text="æœºåŠ¨æ€§:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SelectedItemModifier.Maneuver}" />
                  
                  <TextBlock Grid.Row="2" Grid.Column="0" Text="å†²é”‹ä¼¤å®³:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SelectedItemModifier.ChargeDamage}" />
                  
                  <TextBlock Grid.Row="3" Grid.Column="0" Text="é©¬åŒ¹ç”Ÿå‘½:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                  <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding SelectedItemModifier.HorseHitPoints}" />
                </Grid>
              </StackPanel>
            </Border>
            
          </StackPanel>
          
          <!-- æœªé€‰æ‹©æç¤º -->
          <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" 
                     IsVisible="{Binding SelectedItemModifier, Converter={x:Static ObjectConverters.IsNull}}">
            <TextBlock Text="âœ¨" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,16"/>
            <TextBlock Text="é€‰æ‹©å·¦ä¾§çš„ä¿®é¥°ç¬¦è¿›è¡Œç¼–è¾‘" 
                      FontSize="18" 
                      HorizontalAlignment="Center"
                      Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
          </StackPanel>
        </Grid>
      </ScrollViewer>
      
    </Grid>
  </Grid>
</UserControl> 